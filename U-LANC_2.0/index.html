<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U-LANC: Conceptual Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for a polished look and feel */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Custom toggle switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #4A90E2;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #4A90E2;
        }

        /* Dashed box for important regions */
        .important-region-box {
            position: absolute;
            border: 3px dashed #4A90E2;
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.7);
            transition: opacity 0.3s ease-in-out;
            pointer-events: none; /* Allows clicks to go through */
        }

        /* Video mask for prioritizing faces */
        .video-mask-container {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
        }

        .video-background, .video-foreground {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 0.5rem;
        }

        .video-foreground {
            position: absolute;
            top: 0;
            left: 0;
            clip-path: circle(35% at 50% 40%);
            transition: filter 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                U-LANC
            </h1>
            <p class="text-gray-400 mt-2 text-lg">Universal Lossless-Lossy Adaptive Neural Compression</p>
        </header>

        <!-- Tab Navigation -->
        <nav class="flex justify-center mb-8 bg-gray-800 rounded-lg p-1 shadow-lg">
            <button data-tab="image" class="tab-btn flex-1 py-3 px-4 text-center font-semibold rounded-md transition-all duration-300 bg-blue-600 text-white">Image</button>
            <button data-tab="audio" class="tab-btn flex-1 py-3 px-4 text-center font-semibold rounded-md transition-all duration-300">Audio</button>
            <button data-tab="video" class="tab-btn flex-1 py-3 px-4 text-center font-semibold rounded-md transition-all duration-300">Video</button>
        </nav>

        <!-- Main Content Area -->
        <main>
            <!-- Image Tab Content -->
            <div id="image-tab-content" class="tab-content space-y-8">
                <p class="text-center text-gray-400">Simulates U-LANC's ability to identify and preserve important regions in an image.</p>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Controls -->
                    <div class="lg:col-span-1 bg-gray-800 p-6 rounded-lg shadow-xl">
                        <h3 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-3">AI Controls</h3>
                        
                        <!-- File Upload -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Upload Image</label>
                            <input type="file" id="image-upload" accept="image/*" class="hidden">
                            <div id="file-upload-area" class="bg-gray-700 p-3 rounded-md text-center cursor-pointer hover:bg-gray-600 transition-colors border-2 border-dashed border-gray-600 hover:border-blue-400">
                                <span id="file-upload-text" class="font-mono text-blue-400">Click to upload image</span>
                            </div>
                            <div id="uploaded-file-info" class="hidden mt-2 p-2 bg-green-900/20 border border-green-500 rounded text-sm">
                                <span id="uploaded-filename" class="text-green-400"></span>
                            </div>
                        </div>

                        <!-- Quality Slider -->
                        <div class="mb-8">
                            <label for="image-quality-slider" class="block text-sm font-medium text-gray-300 mb-2">Compression Quality: <span id="image-quality-value" class="font-bold text-blue-400">80%</span></label>
                            <input id="image-quality-slider" type="range" min="10" max="100" value="80" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <!-- Adaptive Toggle -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-3">AI Adaptive Mode</label>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Preserve Important Regions</span>
                                <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" id="image-preserve-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                    <label for="image-preserve-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                                </div>
                            </div>
                            <p id="image-ai-desc" class="text-xs text-gray-500 mt-2 h-10">Standard compression applied equally to all regions.</p>
                        </div>

                        <!-- Region Selection -->
                        <div id="region-selection" class="hidden mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Select Important Regions</label>
                            <div class="space-y-2">
                                <button id="add-region-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white text-sm py-2 px-3 rounded transition-colors">
                                    + Add Region to Preserve
                                </button>
                                <div id="regions-list" class="space-y-1">
                                    <!-- Regions will be added here dynamically -->
                                </div>
                            </div>
                        </div>

                        <!-- Compress Button -->
                        <div class="pt-4 border-t border-gray-700">
                            <button id="compress-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-md transition-colors">
                                ðŸš€ Compress Image
                            </button>
                        </div>
                    </div>

                    <!-- Results -->
                    <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Before -->
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="text-xl font-semibold mb-3 text-center">Before</h4>
                            <div class="relative">
                                <img id="original-image" src="https://images.unsplash.com/photo-1542744173-8e7e53415bb0?q=80&w=1470&auto=format&fit=crop" alt="Original image" class="rounded-lg w-full h-auto">
                                <div class="absolute bottom-2 right-2 bg-black bg-opacity-60 px-3 py-1 rounded-md text-sm">
                                    <p>Original Size: <span id="original-size" class="font-bold">12.5 MB</span></p>
                                </div>
                            </div>
                        </div>
                        <!-- After -->
                        <div class="bg-gray-800 p-4 rounded-lg flex flex-col">
                            <h4 class="text-xl font-semibold mb-3 text-center">After</h4>
                            <div class="relative">
                                <img id="image-after" src="https://images.unsplash.com/photo-1542744173-8e7e53415bb0?q=80&w=1470&auto=format&fit=crop" alt="Compressed meeting photo" class="rounded-lg w-full h-auto transition-all duration-300">
                                <div id="image-important-box" class="important-region-box opacity-0" style="top: 28%; left: 42%; width: 25%; height: 35%;"></div>
                                <div class="absolute bottom-2 right-2 bg-black bg-opacity-60 px-3 py-1 rounded-md text-sm">
                                    <p>New Size: <span id="image-new-size" class="font-bold text-green-400">2.1 MB</span></p>
                                    <p>Reduction: <span id="image-reduction" class="font-bold text-green-400">83.2%</span></p>
                                </div>
                            </div>
                            <!-- AI Decision Report Card -->
                            <div id="image-ai-report" class="mt-4 p-3 bg-gray-900 rounded-md border border-blue-500/30 hidden">
                                <h5 class="font-semibold text-blue-400 text-sm mb-2">ðŸ§  AI Decision Report</h5>
                                <ul class="text-xs text-gray-400 space-y-1">
                                    <li><span class="text-green-400 font-medium">Region 1 (Face):</span> Quality Preserved (Lossless)</li>
                                    <li><span class="text-yellow-400 font-medium">Region 2 (Background):</span> Highly Compressed (Lossy)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Audio Tab Content -->
            <div id="audio-tab-content" class="tab-content hidden space-y-8">
                 <p class="text-center text-gray-400">Simulates how U-LANC adapts audio bitrate for the best balance of size and quality.</p>
                <div class="max-w-3xl mx-auto bg-gray-800 p-8 rounded-lg shadow-xl">
                    <h3 class="text-2xl font-bold mb-6">Audio Compression</h3>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-300 mb-2">File Uploaded</label>
                        <div class="bg-gray-700 p-3 rounded-md text-center">
                            <span class="font-mono">podcast_episode_01.wav</span>
                        </div>
                    </div>

                    <div class="flex items-center justify-center my-8">
                        <!-- Simulated waveform -->
                        <svg class="w-full h-24 text-blue-500" viewBox="0 0 500 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0 50 L20 60 L40 40 L60 55 L80 45 L100 65 L120 35 L140 50 L160 50 L180 70 L200 30 L220 50 L240 45 L260 55 L280 60 L300 40 L320 50 L340 75 L360 25 L380 50 L400 60 L420 40 L440 55 L460 45 L480 65 L500 50" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                        <div>
                            <label for="audio-bitrate-select" class="block text-sm font-medium text-gray-300 mb-2">Target Bitrate (Quality)</label>
                            <select id="audio-bitrate-select" class="w-full bg-gray-700 border-gray-600 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="24" data-quality="Crystal Clear (Lossless-like)">24 kbps</option>
                                <option value="12" data-quality="High Quality (Streaming)">12 kbps</option>
                                <option value="6" selected data-quality="Good (Voice Calls)">6 kbps</option>
                                <option value="3" data-quality="Acceptable (Low Bandwidth)">3 kbps</option>
                                <option value="1.5" data-quality="Highly Compressed (Archival)">1.5 kbps</option>
                            </select>
                        </div>
                        <div class="text-center md:text-left">
                            <p class="text-gray-400">Original Size: <span class="font-bold">28.8 MB</span></p>
                            <p class="text-gray-300">New Size: <span id="audio-new-size" class="font-bold text-green-400">1.3 MB</span></p>
                            <p class="text-gray-300">Reduction: <span id="audio-reduction" class="font-bold text-green-400">95.5%</span></p>
                        </div>
                    </div>
                     <div class="mt-6 p-4 bg-gray-900 rounded-md">
                        <p class="text-sm text-gray-400">ðŸ§  <span class="font-semibold text-gray-300">AI Analysis:</span> <span id="audio-quality-desc">Good (Voice Calls)</span></p>
                    </div>
                </div>
            </div>

            <!-- Video Tab Content -->
            <div id="video-tab-content" class="tab-content hidden space-y-8">
                <p class="text-center text-gray-400">Demonstrates adaptive video compression, prioritizing faces and text for clarity.</p>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Controls -->
                    <div class="lg:col-span-1 bg-gray-800 p-6 rounded-lg shadow-xl">
                        <h3 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-3">AI Controls</h3>
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-300 mb-2">File Uploaded</label>
                            <div class="bg-gray-700 p-3 rounded-md text-center">
                                <span class="font-mono">team_meeting.mp4</span>
                            </div>
                        </div>

                        <div class="mb-8">
                            <label for="video-quality-slider" class="block text-sm font-medium text-gray-300 mb-2">Overall Quality: <span id="video-quality-value" class="font-bold text-blue-400">50%</span></label>
                            <input id="video-quality-slider" type="range" min="10" max="100" value="50" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">AI Adaptive Mode</label>
                             <div class="flex items-center justify-between">
                                <span class="text-gray-400">Prioritize Faces & Text</span>
                                <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" id="video-preserve-toggle" checked class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                    <label for="video-preserve-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                                </div>
                            </div>
                            <p id="video-ai-desc" class="text-xs text-gray-500 mt-2 h-10">Keeps the speaker and on-screen text sharp, even at low quality settings.</p>
                        </div>
                    </div>

                    <!-- Results -->
                    <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Before -->
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="text-xl font-semibold mb-3 text-center">Before</h4>
                            <img src="https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=1632&auto=format=fit=crop" alt="Original video frame" class="rounded-lg w-full h-auto">
                            <div class="mt-3 text-center">
                                <p>Original Size: <span class="font-bold">150 MB</span></p>
                            </div>
                        </div>
                        <!-- After -->
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="text-xl font-semibold mb-3 text-center">After</h4>
                            <div class="video-mask-container">
                                <img id="video-background" src="https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=1632&auto=format=fit=crop" alt="Compressed video frame background" class="video-background">
                                <img id="video-foreground" src="https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=1632&auto=format=fit=crop" alt="Compressed video frame foreground" class="video-foreground">
                            </div>
                            <div class="mt-3 text-center">
                                <p>New Size: <span id="video-new-size" class="font-bold text-green-400">18.8 MB</span></p>
                                <p>Reduction: <span id="video-reduction" class="font-bold text-green-400">87.5%</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Globals ---
            const tabs = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            let uploadedFile = null;
            let selectedRegions = [];

            // --- Image Tab Elements & Logic ---
            const imageSlider = document.getElementById('image-quality-slider');
            const imageQualityValue = document.getElementById('image-quality-value');
            const imagePreserveToggle = document.getElementById('image-preserve-toggle');
            const imageAfter = document.getElementById('image-after');
            const imageImportantBox = document.getElementById('image-important-box');
            const imageNewSize = document.getElementById('image-new-size');
            const imageReduction = document.getElementById('image-reduction');
            const imageAiDesc = document.getElementById('image-ai-desc');
            const imageAiReport = document.getElementById('image-ai-report');
            const originalImage = document.getElementById('original-image');
            const originalSize = document.getElementById('original-size');
            const imageUpload = document.getElementById('image-upload');
            const fileUploadArea = document.getElementById('file-upload-area');
            const fileUploadText = document.getElementById('file-upload-text');
            const uploadedFileInfo = document.getElementById('uploaded-file-info');
            const uploadedFilename = document.getElementById('uploaded-filename');
            const regionSelection = document.getElementById('region-selection');
            const addRegionBtn = document.getElementById('add-region-btn');
            const regionsList = document.getElementById('regions-list');
            
            let originalImageSize = 12.5;
            let isSelectingRegion = false;

            // File Upload Functionality
            function handleFileUpload(file) {
                uploadedFile = file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    originalImage.src = e.target.result;
                    imageAfter.src = e.target.result;
                    originalImageSize = file.size / (1024 * 1024); // Convert to MB
                    originalSize.textContent = `${originalImageSize.toFixed(2)} MB`;
                    
                    uploadedFilename.textContent = file.name;
                    uploadedFileInfo.classList.remove('hidden');
                    fileUploadText.textContent = 'File uploaded successfully';
                    fileUploadArea.classList.add('border-green-400', 'bg-green-900/20');
                    
                    updateImageDemo();
                };
                reader.readAsDataURL(file);
            }

            // Region Selection Functionality
            function startRegionSelection() {
                isSelectingRegion = true;
                originalImage.style.cursor = 'crosshair';
                addRegionBtn.textContent = 'Click on image to select region';
                addRegionBtn.disabled = true;
            }

            function addRegion(x, y, width, height) {
                const region = {
                    id: Date.now(),
                    x: x,
                    y: y,
                    width: width,
                    height: height,
                    name: `Region ${selectedRegions.length + 1}`
                };
                selectedRegions.push(region);
                updateRegionsList();
                updateImageDemo();
            }

            function updateRegionsList() {
                regionsList.innerHTML = '';
                selectedRegions.forEach(region => {
                    const regionDiv = document.createElement('div');
                    regionDiv.className = 'flex items-center justify-between bg-gray-600 p-2 rounded text-sm';
                    regionDiv.innerHTML = `
                        <span class="text-gray-300">${region.name}</span>
                        <button onclick="removeRegion(${region.id})" class="text-red-400 hover:text-red-300">Ã—</button>
                    `;
                    regionsList.appendChild(regionDiv);
                });
            }

            function removeRegion(id) {
                selectedRegions = selectedRegions.filter(r => r.id !== id);
                updateRegionsList();
                updateImageDemo();
            }

            // Make removeRegion global
            window.removeRegion = removeRegion;

            // Compression Functionality
            function compressImage() {
                if (!uploadedFile) {
                    alert('Please upload an image first!');
                    return;
                }

                const quality = parseInt(imageSlider.value);
                const preserve = imagePreserveToggle.checked;
                
                // Simulate compression process
                const compressBtn = document.getElementById('compress-btn');
                compressBtn.textContent = 'ðŸ”„ Compressing...';
                compressBtn.disabled = true;

                setTimeout(() => {
                    // Apply compression effects
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    
                    img.onload = function() {
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        // Apply compression based on quality
                        const compressedDataUrl = canvas.toDataURL('image/jpeg', quality / 100);
                        imageAfter.src = compressedDataUrl;
                        
                        // Calculate new size (simplified)
                        const newSize = (compressedDataUrl.length * 0.75) / (1024 * 1024);
                        const reduction = 100 - (newSize / originalImageSize * 100);
                        
                        imageNewSize.textContent = `${newSize.toFixed(2)} MB`;
                        imageReduction.textContent = `${reduction.toFixed(1)}%`;
                        
                        // Show AI analysis
                        if (preserve && selectedRegions.length > 0) {
                            imageImportantBox.classList.remove('opacity-0');
                            imageAiReport.classList.remove('hidden');
                        }
                        
                        compressBtn.textContent = 'âœ… Compression Complete!';
                        setTimeout(() => {
                            compressBtn.textContent = 'ðŸš€ Compress Image';
                            compressBtn.disabled = false;
                        }, 2000);
                    };
                    
                    img.src = originalImage.src;
                }, 1500);
            }

            function updateImageDemo() {
                const quality = parseInt(imageSlider.value);
                const preserve = imagePreserveToggle.checked;

                imageQualityValue.textContent = `${quality}%`;

                // Simulate quality degradation with CSS filters
                const blurValue = (100 - quality) / 20; // Max blur of 4.5px
                imageAfter.style.filter = `blur(${blurValue}px) brightness(${0.8 + quality / 500})`;
                
                // Simulate file size calculation
                let sizeMultiplier = quality / 100 * 0.3; // Base reduction
                if (preserve && selectedRegions.length > 0) {
                    sizeMultiplier *= 1.4; // Preserving regions has a size cost
                    imageImportantBox.classList.remove('opacity-0');
                    imageAiDesc.textContent = `AI Detected: ${selectedRegions.length} important region(s). Preserving with higher quality.`;
                    imageAiReport.classList.remove('hidden');
                    
                    // Update AI report
                    const reportList = imageAiReport.querySelector('ul');
                    reportList.innerHTML = '';
                    selectedRegions.forEach((region, index) => {
                        const li = document.createElement('li');
                        li.innerHTML = `<span class="text-green-400 font-medium">${region.name}:</span> Quality Preserved (Lossless)`;
                        reportList.appendChild(li);
                    });
                } else if (preserve) {
                    imageImportantBox.classList.add('opacity-0');
                    imageAiDesc.textContent = "AI Adaptive Mode enabled. Add regions to preserve.";
                    imageAiReport.classList.add('hidden');
                } else {
                    imageImportantBox.classList.add('opacity-0');
                    imageAiDesc.textContent = "Standard compression applied equally to all regions.";
                    imageAiReport.classList.add('hidden');
                }

                const newSize = Math.max(originalImageSize * sizeMultiplier, 0.5);
                const reduction = 100 - (newSize / originalImageSize * 100);
                
                imageNewSize.textContent = `${newSize.toFixed(1)} MB`;
                imageReduction.textContent = `${reduction.toFixed(1)}%`;
            }

            // --- Audio Tab Elements & Logic ---
            const audioSelect = document.getElementById('audio-bitrate-select');
            const audioNewSize = document.getElementById('audio-new-size');
            const audioReduction = document.getElementById('audio-reduction');
            const audioQualityDesc = document.getElementById('audio-quality-desc');
            const originalAudioSize = 28.8; // WAV size for ~3 min audio

            function updateAudioDemo() {
                const bitrate = parseFloat(audioSelect.value);
                const selectedOption = audioSelect.options[audioSelect.selectedIndex];
                const qualityText = selectedOption.getAttribute('data-quality');

                // Size in MB = (bitrate in kbps / 8) * seconds / 1024
                const newSize = (bitrate / 8) * 180 / 1024;
                const reduction = 100 - (newSize / originalAudioSize * 100);

                audioNewSize.textContent = `${newSize.toFixed(1)} MB`;
                audioReduction.textContent = `${reduction.toFixed(1)}%`;
                audioQualityDesc.textContent = qualityText;
            }

            // --- Video Tab Elements & Logic ---
            const videoSlider = document.getElementById('video-quality-slider');
            const videoQualityValue = document.getElementById('video-quality-value');
            const videoPreserveToggle = document.getElementById('video-preserve-toggle');
            const videoBackground = document.getElementById('video-background');
            const videoForeground = document.getElementById('video-foreground');
            const videoNewSize = document.getElementById('video-new-size');
            const videoReduction = document.getElementById('video-reduction');
            const videoAiDesc = document.getElementById('video-ai-desc');
            const originalVideoSize = 150;

            function updateVideoDemo() {
                const quality = parseInt(videoSlider.value);
                const preserve = videoPreserveToggle.checked;

                videoQualityValue.textContent = `${quality}%`;

                const blurValue = (100 - quality) / 10;
                
                if (preserve) {
                    // Only blur the background, foreground stays sharp
                    videoBackground.style.filter = `blur(${blurValue}px)`;
                    videoForeground.style.filter = 'blur(0px)';
                    videoForeground.style.opacity = '1';
                    videoAiDesc.textContent = "AI Detected: Speaker & on-screen text. Prioritizing for clarity.";
                } else {
                    // Blur everything
                    videoBackground.style.filter = `blur(${blurValue}px)`;
                    videoForeground.style.opacity = '0'; // Hide the sharp foreground
                    videoAiDesc.textContent = "Standard compression applied equally across the entire video frame.";
                }
                
                let sizeMultiplier = quality / 100 * 0.25;
                if (preserve) {
                    sizeMultiplier *= 1.5; // Cost for adaptive mode
                }

                const newSize = Math.max(originalVideoSize * sizeMultiplier, 5.0);
                const reduction = 100 - (newSize / originalVideoSize * 100);

                videoNewSize.textContent = `${newSize.toFixed(1)} MB`;
                videoReduction.textContent = `${reduction.toFixed(1)}%`;
            }


            // --- Event Listeners ---
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Deactivate all
                    tabs.forEach(t => t.classList.remove('bg-blue-600', 'text-white'));
                    tabContents.forEach(c => c.classList.add('hidden'));

                    // Activate clicked
                    tab.classList.add('bg-blue-600', 'text-white');
                    document.getElementById(`${tab.dataset.tab}-tab-content`).classList.remove('hidden');
                });
            });

            // File Upload Event Listeners
            fileUploadArea.addEventListener('click', () => {
                imageUpload.click();
            });

            imageUpload.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });

            // Drag and Drop
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('border-blue-400', 'bg-blue-900/20');
            });

            fileUploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('border-blue-400', 'bg-blue-900/20');
            });

            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('border-blue-400', 'bg-blue-900/20');
                if (e.dataTransfer.files.length > 0) {
                    handleFileUpload(e.dataTransfer.files[0]);
                }
            });

            // Adaptive Mode Toggle
            imagePreserveToggle.addEventListener('change', (e) => {
                if (e.target.checked) {
                    regionSelection.classList.remove('hidden');
                } else {
                    regionSelection.classList.add('hidden');
                    selectedRegions = [];
                    updateRegionsList();
                }
                updateImageDemo();
            });

            // Region Selection
            addRegionBtn.addEventListener('click', startRegionSelection);

            // Image Click for Region Selection
            originalImage.addEventListener('click', (e) => {
                if (isSelectingRegion) {
                    const rect = originalImage.getBoundingClientRect();
                    const x = ((e.clientX - rect.left) / rect.width) * 100;
                    const y = ((e.clientY - rect.top) / rect.height) * 100;
                    const width = 20; // Default region size
                    const height = 20;
                    
                    addRegion(x, y, width, height);
                    
                    // Reset selection mode
                    isSelectingRegion = false;
                    originalImage.style.cursor = 'default';
                    addRegionBtn.textContent = '+ Add Region to Preserve';
                    addRegionBtn.disabled = false;
                }
            });

            // Quality and other controls
            imageSlider.addEventListener('input', updateImageDemo);
            audioSelect.addEventListener('change', updateAudioDemo);
            videoSlider.addEventListener('input', updateVideoDemo);
            videoPreserveToggle.addEventListener('change', updateVideoDemo);

            // Compression button
            document.getElementById('compress-btn').addEventListener('click', compressImage);


            // --- Initial Calls ---
            updateImageDemo();
            updateAudioDemo();
            updateVideoDemo();
        });
    </script>
</body>
</html>
